{% load static %}

{% block extra_css %}

{% endblock extra_css %}
<style>
    .stop-label {
        position: absolute;
        top: 1.5em;
        transform: translateY(-50%);
        font-size: 12px;
      }
    
      :root {
        --stops: 7; /* Define the number of color stops */
      }
      
      .stop-label:nth-child(n+1) {
        left: calc((100% / var(--stops)) * (n - 1)) %;
      }
    
      .stop-label:last-child {
        right: 0;
      }
    </style>
{% if self.enable_climate == True %}
<section style="background-color:#f9f9f9; padding-top: 4rem; padding-bottom:4rem;" class="has-text-centered">
    <div class="container">

        <h2 class="title py-4" style="font-size: 27px; font-weight:700">{{self.climate_title}}</h2>

        <div class="columns is-justify-content-center">
            <div class="column is-11">
                <div class="card">
                    <div id="climate-map" style="min-height: 400px;border-radius: 0.5rem;"></div>

                    <div id="floating-div" style="position: absolute;
                              top: 1.0em;
                              right: 0.5em;
                              z-index: 1;
                              background-color: white;
                              padding: 10px;
                              border-radius: 5px;
                              width:250px;
                              box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
                              text-align:left;
                              height:auto
                              ">
                                
                                <p style="font-weight:600; font-size:14px;margin-bottom:1em" class="title">Surface Temperature Forecast</p>
                                <p style="margin-bottom:0.5em;font-size:12px;" class="subtitle"><b>Period:</b> 2023-03-05</p>
                               
                                {% comment %} <hr style="background-color:#cad2d3; margin-top:0; margin-bottom:0.5em"> {% endcomment %}
                                <div style="width: 100%;
                                height: 0.3em;
                                position: relative;
                                margin-bottom:2em;
                                background: linear-gradient(to right, #9589D3, #81ccc5 , #5f8fc5 , #79921c, #dfb106, #ec5f15, #8A2B0A);
                              ">
                                    <span class="stop-label">-20</span>
                                    <span class="stop-label">-10</span>
                                    <span class="stop-label">0</span>
                                    <span class="stop-label">10</span>
                                    <span class="stop-label">20</span>
                                    <span class="stop-label">30</span>
                                    <span class="stop-label">40 Â°C</span>
                                </div>
                               
                              </div>

                </div>

            </div>
        </div>

        <div style="padding-top: 1rem;">
            <a class="button is-dark has-text-white" style="font-weight: 500; font-size:15px;border-radius: 0.4em;">
                <span>Explore on Hazards Watch</span>

                <span class="icon">
                    <i class="fa fa-chevron-right"></i>
                </span>
            </a>
        </div>
    </div>


</section>

{% endif %}

{% block extra_js %}
<script>

mapboxgl.accessToken = 'pk.eyJ1IjoiZ3JhY2VhbW9uZGkiLCJhIjoiY2s4dGphcGQwMDBhcjNmcnkzdGk3MnlrZCJ9.54r40Umo0l3dHseEbrQpUg';

const climateMap = new mapboxgl.Map({
    container: 'climate-map', // container ID
    // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
    style: 'mapbox://styles/mapbox/dark-v10', // style URL
    center: [30.30252782218591,
        15.302857659429051], // starting position [lng, lat]
    zoom: 4.2, // starting zoom
    scrollZoom: false

});

// Add zoom and rotation controls to the map.
climateMap.addControl(new mapboxgl.NavigationControl(), 'bottom-right');

climateMap.on("load", () => {

    if('{{settings.site_settings.CountrySetting.country.geom}}'){
        const wktWithoutSrids = '{{settings.site_settings.CountrySetting.country.geom}}'.replace(/^SRID=\d+;/, "");

      // define a regular expression pattern to match the coordinates
        const pattern = /\(([^()]+)\)/g;

        // create an array to store the coordinates
        let coordinates = [];

        // loop through each match of the pattern and extract the coordinates
        let match;
        while ((match = pattern.exec(wktWithoutSrids)) !== null) {
            // split the match into individual coordinates
            const coords = match[1].trim().split(', ');
            // convert the coordinates to an array of numbers
            const coordsArray = coords.map(coord => coord.split(" ").map(co => Number(co)) );
            // add the coordinates to the array
            coordinates.push(coordsArray);

        }

        var multipolyFeature = {
            type: "Feature",
            geometry: {
              type: "MultiPolygon",
              coordinates: [coordinates],
            },
          }

        // output the coordinates to the console
        var bounds = turf.bbox({
            type: "FeatureCollection",
            features: [multipolyFeature],
          });
          climateMap.fitBounds(bounds, { padding: 20 });

    }

    climateMap.addSource('wms-source', {
        type: "raster",
        tiles: [
          //`http://20.56.94.119/gsky/ows/gfs?service=WMS&request=GetMap&version=1.1.1&width=256&height=256&styles=&transparent=true&srs=EPSG:3857&bbox={bbox-epsg-3857}&format=image/png&time=2023-03-05T18:00:00.000Z&layers=gfs_temperature_2_m&clip_feature=2234`,
          `https://eahazardswatch.icpac.net/gsky/ows/?service=WMS&request=GetMap&version=1.1.1&width=256&height=256&styles=&transparent=true&srs=EPSG:3857&bbox={bbox-epsg-3857}&format=image/png&time=2023-03-01T00:00:00.000Z&layers=weekly_mean_temp&clip_wkt=ETH`
        ],
        minzoom: 3,
        maxzoom: 12,
        'tileSize': 256

      });
    
      climateMap.addLayer({
        'id': 'wms-layer',
        'type': 'raster',
        'source': 'wms-source',
        'paint':{
            'raster-opacity':0.8
        }
      });
})
</script>


{% endblock extra_js %}