{% load static nmhs_cms_tags%}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/climate.css' %}" type="text/css" />

{% endblock extra_css %}

{% if self.enable_climate == True %}

{% comment %} <section class="listing-section">
  <h2 id="results" class="section-title has-text-centered">Browse CAP Alerts</h2>
  <div class="container">
    <div class="columns" style="width: 100%;margin: 0">
      <div class="column is-3 is-full-mobile">
        {% include 'cap_filter_include.html' with filters=page.filters %}
      </div>
      <div class="column is-9 is-full-mobile">
        {% include 'cap_list_include.html' with caps=caps %}
      </div>
    </div>
  </div>
</section> {% endcomment %}

<section style="padding-top: 4rem; padding-bottom:4rem;" class="has-text-centered">
  <div class="container">

    <h2 class="title py-4" style="font-weight:700">{{self.climate_title}}</h2>

    <div class="columns is-justify-content-center">
      <div class="column is-11">
        <div class="card">
          <div id="climate-map" style="min-height: 450px;border-radius: 0.5rem;"></div>
          {% with selected_category=self.get_wms_layers.wms_layers|first %}

          <div id="floating-layer" class="layer-panel">
            <div class="layer-list has-text-white">

              <div class="field has-addons">

                <p class="control pb-0" style="background-color:#f5f5f5;border-radius:2em">

                  {% for category in self.get_wms_layers.categories %}
                  <button style="border-radius:2em"
                    class="button category-btn {% if category.id == selected_category.category_id %}active{% endif %}"
                    id="{{category.id}}" data-category="{{ category.id }}">{{ category.name }}</button>

                  {% endfor %}

                </p>

              </div>

              <div class="layer-list-items">
                {% for layer in self.get_wms_layers.wms_layers %}
                <div style="align-items: flex-start;{% if layer.category_id == selected_category.category_id %}display:flex; {% else %} display:none;{% endif %} padding: 0.5em 0"
                class="layer-list-block {% if forloop.first %} active{% endif %}"
                data-category="{{ layer.category_id }}"
                id="{{layer.id}}"
                >
                {% if layer.icon %}
                  <figure class="image layer-icon">
                      {% svg layer.icon__file %}
                  </figure>
                  {% endif %}
                <h2 
                  class="layer-item subtitle">
                  
                  {{layer.title}}
                </h2>
              </div>
                {% endfor %}
              </div>


            </div>
          </div>
          {% endwith %}

          <div id="floating-legend" class="legend-panel">
          </div>

        </div>

      </div>
    </div>

    <div style="padding-top: 1rem;">
      <a class="button is-dark has-text-white" style="font-weight: 500; font-size:15px;border-radius: 0.4em;" href="http://20.56.94.119/">
        <span>Explore on Hazards Watch</span>

        <span class="icon">
          <i class="fa fa-chevron-right"></i>
        </span>
      </a>
    </div>
  </div>
</section>


{% block extra_js %}
<script>
  var country_geom = "{{settings.site_settings.OrganisationSetting.country.geom}}"
  const countryIso = "{{settings.site_settings.OrganisationSetting.country.iso}}"

  var wms_layers = JSON.parse('{{self.get_wms_layers.wms_layers_json|escapejs}}')
  var wms_categories = JSON.parse('{{self.get_wms_layers.categories_json|escapejs}}')
  // Get all the category buttons
  

  // const defaultCategory = wms_categories[0].id;
  // console.log(defaultCategory)
  // categoryButtons.forEach(button => {
  //  if (button.dataset.category === defaultCategory) {
  //    button.click();
  //  }
  //});

  // Show the layers belonging to the first category by default


</script>
<script type="text/javascript" src="{% static 'js/climate_map.js' %}"></script>


{% endblock extra_js %}

{% endif %}
