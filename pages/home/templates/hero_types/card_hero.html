{% load static wagtailcore_tags wagtailimages_tags lazyimages_tags %}

{% image page.hero_banner original as img %}
<div id="page-hero" class="hero"
     style="position: relative;max-height:fit-content; min-height:600px">
    <div class="hero-body pb-2">
        <div class="container">
            <div id="filtered-forecasts">

                <div class="columns is-justify-content-center is-align-items-center py-3">
                    <div class="column is-5 px-4">
                        <p class="title pb-4"
                        style="font-weight:700; font-size: 34px;">
                            {{ self.hero_title|richtext }}
                        </p>
                        <p class="subtitle pb-5 mb-4"
                        style="font-weight: 400; font-size: 16px;">
                            {{ self.hero_subtitle }}
                        </p>
                    </div>

                    {% if self.show_city_forecast and grouped_forecast|length > 0 %}
                    <div class="column is-7" style="border-left:solid 1px #aeaeae4f">

                        <div class="weather-widget px-6" style="background-color:white">
                            
                            <div class="card py-4 progressive__bg progressive--not-loaded" 
                            style="text-align:center;color:white; background-image: url({% lazy_image_url img %});background-position:center; background-repeat:no-repeat; background-size:cover; border-radius:1em"
                            data-progressive="{{ img.url }}">
                            <div class="widget-control">
                                <form id="filter-form">
                                    <div class="field has-addons">
                                        <div class="control is-expanded px-6 has-icons-left">
                                            <div class="select is-fullwidth is-white">
                                                <select id="city-option" style="border: none;
                                                border-bottom: solid 1px #d5d5d5; box-shadow: none; font-weight:500"
                                                    name="city_name">
                                                    {% for city in self.city_item.cities %}
                                                    <option value="{{city.name}}" {% if request.GET.city_name == city.name %}selected{% endif %}>{{city.name}}</option>
                                                    {% endfor %}
                                                </select>
                                                <span class="icon is-small is-left is-white">
                                                    <i class="fas fa-location-dot"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            {% for forecasts in grouped_forecast %}

                                {% if forloop.first %}
                                
                                <div class="card-content" style="background-color: #ffffff20;margin: 1em 2em 0;backdrop-filter: blur(10px);font-weight:600">
                                    

                                    {% with forecasts.forecast_items|first as latest_forecast %}
                                <div class="widget-header">
                                    <p class="city-name pb-0" style="font-weight:600; font-size:24px">
                                        {{ forecasts.city|wordwrap:7}}
                                    </p>
                                    <p class="latest-forecast-date"  style="font-size:14px">
                                        {{ latest_forecast.forecast_date|wordwrap:15|linebreaksbr}}
                                    </p>
                                </div>
                                

                                <div class="widget-weather">
                                    <div class="columns is-mobile">
                                        <div class="column weather-temp p-0 is-desktop" style="text-align:right">
                                            {% if latest_forecast.data_value.air_temperature_max %}
                                            <p style="font-size:40px; font-weight: 300"> {{ latest_forecast.data_value.air_temperature_max|floatformat:0 }}{{ settings.forecastmanager.ForecastSetting.get_temp_units_display }}</p>
                                            {% endif %}
                                            
                                            {% if latest_forecast.data_value.air_temperature_min %}
                                            <p style="font-size:20px; font-weight: 300"> {{ latest_forecast.data_value.air_temperature_min|floatformat:0 }}{{ settings.forecastmanager.ForecastSetting.get_temp_units_display }}</p>
                                            {% endif %}
                                        </div>

                                        {% if latest_forecast.condition %}
                                        <div class="column weather-condition p-0 is-desktop">
                                            <img 
                                            src="{% static 'forecastmanager/img/'|add:latest_forecast.condition|add:'.png' %}"
                                            alt="{{ latest_forecast.condition }}"
                                            title="{{ latest_forecast.condition_display }}">
                                            <p>{{ latest_forecast.condition_display|wordwrap:10|linebreaksbr}}</p>
                                        </div>
                                        {% endif %}

                                        <div class="column weather-others p-0" style="text-align:left">
                                            {% if latest_forecast.data_value.relative_humidity %}
                                            <p style="display:flex">
                                                <img src="{% static 'img/humidity_icon_white.png' %}" style="height:20px" class="px-2">
                                                <span>{{ latest_forecast.data_value.relative_humidity}}% </span>
                                            </p>
                                            {% endif %}
                                            
                                            {% if latest_forecast.data_value.wind_from_direction %}
                                            <p style="display:flex">
                                                <img src="{% static 'img/winddirection_icon_white.png' %}"  class="px-2" style="height:20px;transform:rotate(calc({{latest_forecast.data_value.wind_from_direction}}deg))">
                                                <span>{{ latest_forecast.data_value.wind_from_direction}}Â° </span>
                                            </p>
                                            {% endif %}


                                            {% if latest_forecast.data_value.wind_speed %}
                                            <p style="display:flex">
                                                <img src="{% static 'img/windspeed_icon_white.png' %}"  class="px-2" style="height:20px;">
                                                <span>{{ latest_forecast.data_value.wind_speed}}m/s </span>
                                            </p>
                                            {% endif %}

                                            {% if latest_forecast.data_value.air_pressure_at_sea_level %}
                                            <p style="display:flex">
                                                <img src="{% static 'img/pressure_icon_white.png' %}"  class="px-2" style="height:20px;">
                                                <span>{{ latest_forecast.data_value.air_pressure_at_sea_level}}hPa </span>
                                            </p>
                                            {% endif %}

                                            {% if latest_forecast.data_value.precipitation_amount %}
                                            <p style="display:flex">
                                                <img src="{% static 'img/precipitation_icon_white.png' %}"  class="px-2" style="height:20px;">
                                                <span>{{ latest_forecast.data_value.precipitation_amount}}mm </span>
                                            </p>
                                            {% endif %}

                                            {% if latest_forecast.data_value.sunrise %}
                                            <p style="display:flex">
                                                <img src="{% static 'img/sunrise_icon_white.png' %}"  class="px-2" style="height:20px;">
                                                <span>{{ latest_forecast.data_value.sunrise}} sunrise</span>
                                            </p>
                                            {% endif %}

                                            {% if latest_forecast.data_value.sunset %}
                                            <p style="display:flex">
                                                <img src="{% static 'img/sunset_icon_white.png' %}"  class="px-2" style="height:20px;">
                                                <span>{{ latest_forecast.data_value.sunset}} sunset</span>
                                            </p>
                                            {% endif %}

                                            {% if latest_forecast.data_value.moonrise %}
                                            <p style="display:flex">
                                                <img src="{% static 'img/moonrise_icon_white.png' %}"  class="px-2" style="height:20px;">
                                                <span>{{ latest_forecast.data_value.moonrise}} sunrise</span>
                                            </p>
                                            {% endif %}

                                            {% if latest_forecast.data_value.moonset %}
                                            <p style="display:flex">
                                                <img src="{% static 'img/moonset_icon_white.png' %}"  class="px-2" style="height:20px;">
                                                <span>{{ latest_forecast.data_value.moonset}}</span>
                                            </p>
                                            {% endif %}

                                            

                                        </div>
                                    </div>
                                </div>
                                {% endwith %}
                                
                                </div>
                                

                                <footer class="card-footer widget-days carousel weather-days-carousel" id="carousel" style="background-color: #ffffff60;
                                margin: 0 2em 1em; backdrop-filter: blur(30px);">
                                {% for item in forecasts.forecast_items %}

                                    {% if not forloop.first %}
                                        <div class="card-footer-item">
                                            <div>
                                                {{ item.forecast_date }}
                                            </div>
                                            <div>
                                                <img 
                                                src="{% static 'forecastmanager/img/'|add:item.condition|add:'.png' %}"
                                                alt="{{ item.condition_display }}"
                                                title="{{ item.condition_display }}"
                                                style="height:35px">
                                            </div>
                                            <div>
                                                <p>
                                                    {% if item.data_value.air_temperature_max %}
                                                    <span style="font-size:18px; font-weight:600">{{ item.data_value.air_temperature_max|floatformat:0 }} {{ settings.forecastmanager.ForecastSetting.get_temp_units_display }}</span>
                                                    {% endif %}

                                                    {% if item.data_value.air_temperature_min %}
                                                    <span style="font-size:12px">{{ item.data_value.air_temperature_min|floatformat:0 }} {{ settings.forecastmanager.ForecastSetting.get_temp_units_display }}</span>
                                                    {% endif %}
                                                    
                                                </p>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}         
                                            
                                </footer>
                                
                                {% endif %}
                                {% endfor %}
                            </div>

                            <div class="buttons forecast pt-4">

                                <a class="button is-small has-text-weight-bold is-dark has-text-white is-rounded"
                                href="{% url 'list_forecasts' %}"
                                >
                                    <span class="icon">
                                        <i class="fa-solid fa-list"></i> </span>
                                    <span> All City Forecast</span>
        
                                </a>
                                <a class="button is-small has-text-weight-bold is-dark has-text-white is-rounded"
                                href="{% url 'daily_weather' %}">
                                    <span class="icon">
                                        <i class="fa fa-cloud-sun-rain"></i>
                                    </span>
                                    <span> Daily Weather</span>
                                </a>
                            </div>
                        </div>

                        

                        {% comment %} {% include 'section/city_forecast_include.html' %} {% endcomment %}

                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

